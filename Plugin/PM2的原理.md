## cluster

Node.js 的 Cluster 多进程模式。

PM2 的实现原理，它是基于 Cluster 模式的封装。

Node.js，都是以单线程的方式运行的，因此，在多核心处理器的系统中并不能发挥其最大的性能。

Node.js 的 cluster 模块
　　幸运的是，Node.js 给我们提供了 cluster 模块，它可以生成多个工作线程来共享同一个 TCP 连接。

它是如何运作的呢？

首先，Cluster 会创建一个 master，然后根据你指定的数量复制出多个 server app（也被称之为工作线程）。它通过 IPC 通道与工作线程之间进行通信，并使用内置的负载均衡来更好地处理线程之间的压力，该负载均衡使用了 Round-robin 算法（也被称之为循环算法）。

## fork 和 cluster 区别

fork 模式，单实例多进程，常用于多语言混编，比如 php、python 等，不支持端口复用，需要自己做应用的端口分配和负载均衡的子进程业务代码。
缺点就是单服务器实例容易由于异常会导致服务器实例崩溃。

cluster 模式，多实例多进程，但是只支持 node，端口可以复用，不需要额外的端口配置，0 代码实现负载均衡。
优点就是由于多实例机制，可以保证服务器的容错性，就算出现异常也不会使多个服务器实例同时崩溃。

共同点，由于都是多进程，都需要消息机制或数据持久化来实现数据共享。
